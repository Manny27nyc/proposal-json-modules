<!doctype html>
<head><meta charset="utf-8">
<script src="ecmarkup.js"></script>
<link rel="stylesheet" href="ecmarkup.css">
<title>JSON modules</title>
<script type="application/json" id="menu-search-biblio">[{"type":"clause","id":"intro","aoid":null,"title":"JSON modules","titleHTML":"JSON modules","number":"","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":[],"key":"JSON modules"},{"type":"op","aoid":"HostResolveImportedModule","refId":"sec-hostresolveimportedmodule","location":"","referencingIds":[],"key":"HostResolveImportedModule"},{"type":"clause","id":"sec-hostresolveimportedmodule","aoid":"HostResolveImportedModule","title":"Runtime Semantics: HostResolveImportedModule ( referencingScriptOrModule, moduleRequest )","titleHTML":"Runtime Semantics: HostResolveImportedModule ( <var>referencingScriptOrModule</var>, <var>moduleRequest</var> )","number":"1.1","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":[],"key":"Runtime Semantics: HostResolveImportedModule ( referencingScriptOrModule, moduleRequest )"},{"type":"term","term":"Synthetic Module Record","refId":"sec-synthetic-module-records","referencingIds":[],"namespace":"https://github.com/tc39/proposal-json-modules","location":"","key":"Synthetic Module Record"},{"type":"table","id":"table-synthetic-module-record-fields","number":1,"caption":"Table 1: Additional Fields of Synthetic Module Records","referencingIds":["_ref_0"],"namespace":"https://github.com/tc39/proposal-json-modules","location":"","key":"Table 1: Additional Fields of Synthetic Module Records"},{"type":"op","aoid":"CreateSyntheticModule","refId":"sec-createsyntheticmodule","location":"","referencingIds":[],"key":"CreateSyntheticModule"},{"type":"clause","id":"sec-createsyntheticmodule","aoid":"CreateSyntheticModule","title":"CreateSyntheticModule ( exportNames, evaluationSteps, realm, hostDefined )","titleHTML":"CreateSyntheticModule ( <var>exportNames</var>, <var>evaluationSteps</var>, <var>realm</var>, <var>hostDefined</var> )","number":"1.2.1","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":["_ref_2","_ref_4","_ref_24"],"key":"CreateSyntheticModule ( exportNames, evaluationSteps, realm, hostDefined )"},{"type":"op","aoid":"SetSyntheticModuleExport","refId":"sec-setsyntheticmoduleexport","location":"","referencingIds":[],"key":"SetSyntheticModuleExport"},{"type":"clause","id":"sec-setsyntheticmoduleexport","aoid":"SetSyntheticModuleExport","title":"SetSyntheticModuleExport ( module, exportName, exportValue )","titleHTML":"SetSyntheticModuleExport ( <var>module</var>, <var>exportName</var>, <var>exportValue</var> )","number":"1.2.2","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":["_ref_3","_ref_6","_ref_25"],"key":"SetSyntheticModuleExport ( module, exportName, exportValue )"},{"type":"clause","id":"sec-smr-getexportednames","aoid":null,"title":"GetExportedNames( exportStarSet )","titleHTML":"GetExportedNames( <var>exportStarSet</var> )","number":"1.2.3.1","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":[],"key":"GetExportedNames( exportStarSet )"},{"type":"clause","id":"sec-smr-resolveexport","aoid":null,"title":"ResolveExport( exportName, resolveSet )","titleHTML":"ResolveExport( <var>exportName</var>, <var>resolveSet</var> )","number":"1.2.3.2","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":[],"key":"ResolveExport( exportName, resolveSet )"},{"type":"clause","id":"sec-smr-instantiate","aoid":null,"title":"Instantiate ( )","titleHTML":"Instantiate ( )","number":"1.2.3.3","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":[],"key":"Instantiate ( )"},{"type":"clause","id":"sec-smr-Evaluate","aoid":null,"title":"Evaluate ( )","titleHTML":"Evaluate ( )","number":"1.2.3.4","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":[],"key":"Evaluate ( )"},{"type":"clause","id":"sec-smr-concrete-methods","aoid":null,"title":"Concrete Methods","titleHTML":"Concrete Methods","number":"1.2.3","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":[],"key":"Concrete Methods"},{"type":"clause","id":"sec-synthetic-module-records","aoid":null,"title":"Synthetic Module Records","titleHTML":"Synthetic Module Records","number":"1.2","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":["_ref_5","_ref_7","_ref_8","_ref_9","_ref_10","_ref_11","_ref_12","_ref_13","_ref_14","_ref_15","_ref_16","_ref_18","_ref_19","_ref_23"],"key":"Synthetic Module Records"},{"type":"op","aoid":"CreateDefaultExportSyntheticModule","refId":"sec-create-default-export-synthetic-module","location":"","referencingIds":[],"key":"CreateDefaultExportSyntheticModule"},{"type":"clause","id":"sec-create-default-export-synthetic-module","aoid":"CreateDefaultExportSyntheticModule","title":"CreateDefaultExportSyntheticModule ( defaultExport )","titleHTML":"CreateDefaultExportSyntheticModule ( <var>defaultExport</var> )","number":"1.3","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":["_ref_27"],"key":"CreateDefaultExportSyntheticModule ( defaultExport )"},{"type":"op","aoid":"ParseJSONModule","refId":"sec-parse-json-module","location":"","referencingIds":[],"key":"ParseJSONModule"},{"type":"clause","id":"sec-parse-json-module","aoid":"ParseJSONModule","title":"ParseJSONModule ( source )","titleHTML":"ParseJSONModule ( <var>source</var> )","number":"1.4","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":["_ref_1"],"key":"ParseJSONModule ( source )"},{"type":"clause","id":"sec-semantics","aoid":null,"title":"Semantics","titleHTML":"Semantics","number":"1","namespace":"https://github.com/tc39/proposal-json-modules","location":"","referencingIds":[],"key":"Semantics"}]</script></head><body><div id="menu-toggle">☰</div><div id="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#intro" title="JSON modules">JSON modules</a></li><li><span class="item-toggle">◢</span><a href="#sec-semantics" title="Semantics"><span class="secnum">1</span> Semantics</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-hostresolveimportedmodule" title="Runtime Semantics: HostResolveImportedModule ( referencingScriptOrModule, moduleRequest )"><span class="secnum">1.1</span> RS: HostResolveImportedModule ( <var>referencingScriptOrModule</var>, <var>moduleRequest</var> )</a></li><li><span class="item-toggle">◢</span><a href="#sec-synthetic-module-records" title="Synthetic Module Records"><span class="secnum">1.2</span> Synthetic Module Records</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-createsyntheticmodule" title="CreateSyntheticModule ( exportNames, evaluationSteps, realm, hostDefined )"><span class="secnum">1.2.1</span> CreateSyntheticModule ( <var>exportNames</var>, <var>evaluationSteps</var>, <var>realm</var>, <var>hostDefined</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-setsyntheticmoduleexport" title="SetSyntheticModuleExport ( module, exportName, exportValue )"><span class="secnum">1.2.2</span> SetSyntheticModuleExport ( <var>module</var>, <var>exportName</var>, <var>exportValue</var> )</a></li><li><span class="item-toggle">◢</span><a href="#sec-smr-concrete-methods" title="Concrete Methods"><span class="secnum">1.2.3</span> Concrete Methods</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-smr-getexportednames" title="GetExportedNames( exportStarSet )"><span class="secnum">1.2.3.1</span> GetExportedNames( <var>exportStarSet</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-smr-resolveexport" title="ResolveExport( exportName, resolveSet )"><span class="secnum">1.2.3.2</span> ResolveExport( <var>exportName</var>, <var>resolveSet</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-smr-instantiate" title="Instantiate ( )"><span class="secnum">1.2.3.3</span> Instantiate ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-smr-Evaluate" title="Evaluate ( )"><span class="secnum">1.2.3.4</span> Evaluate ( )</a></li></ol></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-create-default-export-synthetic-module" title="CreateDefaultExportSyntheticModule ( defaultExport )"><span class="secnum">1.3</span> CreateDefaultExportSyntheticModule ( <var>defaultExport</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-parse-json-module" title="ParseJSONModule ( source )"><span class="secnum">1.4</span> ParseJSONModule ( <var>source</var> )</a></li></ol></li></ol></div></div><div id="spec-container"><h1 class="version first">Stage 3 Draft / February 6, 2021</h1>
<emu-intro id="intro">
  <h1>JSON modules</h1>
  <p>See <a href="https://github.com/tc39/proposal-json-modules/blob/master/README.md">the explainer</a> for information.</p>
</emu-intro>

<emu-clause id="sec-semantics">
  <h1><span class="secnum">1</span> Semantics</h1>

  <emu-clause id="sec-hostresolveimportedmodule" aoid="HostResolveImportedModule">
    <h1><span class="secnum">1.1</span> Runtime Semantics: HostResolveImportedModule ( <var>referencingScriptOrModule</var>, <var>moduleRequest</var> )</h1>
    <emu-note><span class="note">Note 1</span><div class="note-contents">
      <p>The changes made to this abstract operation in this proposal build on the changes in the <a href="https://tc39.es/proposal-import-assertions/#sec-hostresolveimportedmodule">import assertions</a> proposal.  In order to distingush them, the changes unique to this proposal are labeled as insertions while the changes from import assertions are not labeled.</p>
    </div></emu-note>

    <p>HostResolveImportedModule is an implementation-defined abstract operation that provides the concrete <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> subclass instance that corresponds to the ModuleRequest <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> <var>moduleRequest</var> occurring within the context of the script or module represented by the <emu-xref href="#script-record"><a href="https://tc39.es/ecma262/#script-record">Script Record</a></emu-xref> or <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> <var>referencingScriptOrModule</var>. <var>referencingScriptOrModule</var> may also be <emu-val>null</emu-val>, if the resolution is being performed in the context of an <emu-xref href="#sec-import-calls"><a href="https://tc39.es/ecma262/#sec-import-calls"><code>import()</code></a></emu-xref> expression, and there is no active script or module at that time.</p>

    <emu-note><span class="note">Note 2</span><div class="note-contents">
      <p>An example of when <var>referencingScriptOrModule</var> can be <emu-val>null</emu-val> is in a web browser host. There, if a user clicks on a control given by</p>

      <pre><code class="html hljs"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"import('./foo.mjs')"</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></code></pre>

      <p>there will be no active script or module at the time the <emu-xref href="#sec-import-calls"><a href="https://tc39.es/ecma262/#sec-import-calls"><code>import()</code></a></emu-xref> expression runs. More generally, this can happen in any situation where the host pushes execution contexts with <emu-val>null</emu-val> ScriptOrModule components onto the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>.</p>
    </div></emu-note>

    <p>The implementation of HostResolveImportedModule must conform to the following requirements:</p>
    <ul>
      <li>
        The normal return value must be an instance of a concrete subclass of <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref>.
      </li>
      <li>
        If a <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> corresponding to the pair <var>referencingScriptOrModule</var>, <var>moduleRequest</var>does not exist or cannot be created, an exception must be thrown.
      </li>
      <li>
        Each time this operation is called with a specific <var>referencingScriptOrModule</var>, <var>moduleRequest</var>.[[Specifier]], <var>moduleRequest</var>.[[Assertions]] triple as arguments it must return the same <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> instance if it completes normally.
        <ul>
          <li>
            It is recommended but not required that when possible, implementations additionally conform to the following stronger constraint: each time this operation is called with a specific <var>referencingScriptOrModule</var>, <var>moduleRequest</var>.[[Specifier]] pair as arguments it must return the same <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> instance if it completes normally.
          </li>
        </ul>
      </li>
      <li>
        <var>moduleRequest</var>.[[Assertions]] must not influence the interpretation of the module or the module specifier; instead, it may be used to determine whether the algorithm completes normally or with an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>.
      </li>
      <li>
        <ins>
          If <var>assertions</var> has an entry <var>entry</var> such that <var>entry</var>.[[Key]] is <emu-val>"type"</emu-val>, let <var>type</var> be <var>entry</var>.[[Value]]. The following requirements apply:
          <ul>
            <li><ins>If <var>type</var> is <emu-val>"json"</emu-val>, then this algorithm must either invoke <emu-xref aoid="ParseJSONModule" id="_ref_1"><a href="#sec-parse-json-module">ParseJSONModule</a></emu-xref> and return the resulting <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">Completion Record</a></emu-xref>, or throw an exception.</ins></li>
          </ul>
        </ins>
      </li>
    </ul>
    <p>Multiple different <var>referencingScriptOrModule</var>, <var>moduleRequest</var>.[[Specifier]] pairs may map to the same <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> instance. The actual mapping semantic is implementation-defined but typically a normalization process is applied to <var>specifier</var> as part of the mapping process. A typical normalization process would include actions such as alphabetic case folding and expansion of relative and abbreviated path specifiers.</p>

    <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
      <p>The above text implies that is recommended but not required that hosts do not use <var>moduleRequest</var>.[[Assertions]] as part of the module cache key. In either case, an exception thrown from an import with a given assertion list does not rule out success of another import with the same specifier but a different assertion list.</p>
      <p>Assertions do not affect the contents of the module. Future follow-up proposals may relax this restriction with "evaluator attributes" that would change the contents of the module. There are three possible ways to handle multiple imports of the same module with "evaluator attributes":</p>
      <ul>
        <li><strong>Race</strong> and use the attribute that was requested by the first import. This seems broken--the second usage is ignored.</li>
        <li><strong>Reject</strong> the module graph and don't load if attributes differ. This seems bad for composition--using two unrelated packages together could break, if they load the same module with disagreeing attributes.</li>
        <li><strong>Clone</strong> and make two copies of the module, for the different ways it's transformed. In this case, the attributes would have to be part of the cache key. These semantics would run counter to the intuition that there is just one copy of a module.</li>
      </ul>
      <p>It's possible that one of these three options may make sense for a module load, on a case-by-case basis by attribute, but it's worth careful thought before making this choice.</p>
    </div></emu-note>


    <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
      <p><ins>The above text implies that hosts <emu-val>must</emu-val> support JSON modules imported with <code>type: "json"</code> (if it completes normally), but it doesn't prohibit hosts from supporting JSON modules imported with no type specified. Some environments (for example, web browsers) are expected to require <code>assert { type: "json" }</code>, and environments which want to restrict themselves to a compatible subset would do so as well.</ins></p>
    </div></emu-note>

    <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
      <p><ins>All of the import statements in the module graph that address the same JSON module will evaluate to the same mutable object.</ins></p>
    </div></emu-note>
  </emu-clause>

  <emu-clause id="sec-synthetic-module-records">
    <h1><span class="secnum">1.2</span> Synthetic Module Records</h1>

    <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">This Synthetic Module Records specification text comes from the <a href="https://github.com/tc39/proposal-javascript-standard-library/">JavaScript Standard Library proposal</a> and was written by Domenic Denicola. A version of this text exists <a href="https://heycam.github.io/webidl/#synthetic-module-records">in WebIDL</a>. A version of the text is copied here to clarify that the concept of Synthetic Module Records can proceed in standardization independently of the built-in modules effort.</div></emu-note>

    <p>A <dfn>Synthetic Module Record</dfn> is used to represent information about a module that is defined by specifications. Its exports are derived from a pair of lists, of string keys and of ECMAScript values. The set of exported names is static, and determined at creation time (as an argument to <emu-xref aoid="CreateSyntheticModule" id="_ref_2"><a href="#sec-createsyntheticmodule">CreateSyntheticModule</a></emu-xref>), while the set of exported values can be changed over time using <emu-xref aoid="SetSyntheticModuleExport" id="_ref_3"><a href="#sec-setsyntheticmoduleexport">SetSyntheticModuleExport</a></emu-xref>. It has no imports or dependencies.</p>

    <emu-note><span class="note">Note</span><div class="note-contents">A Synthetic Module Record could be used for defining a variety of module types: for example, built-in modules, or JSON modules, or CSS modules.</div></emu-note>

    <p>In addition to the fields defined in <emu-xref href="#table-36"><a href="https://tc39.es/ecma262/#table-36">Table 40</a></emu-xref>, Synthetic Module Records have the additional fields listed in <emu-xref href="#table-synthetic-module-record-fields" id="_ref_0"><a href="#table-synthetic-module-record-fields">Table 1</a></emu-xref>. Each of these fields is initially set in <emu-xref aoid="CreateSyntheticModule" id="_ref_4"><a href="#sec-createsyntheticmodule">CreateSyntheticModule</a></emu-xref>.</p>

    <emu-table id="table-synthetic-module-record-fields" caption="Additional Fields of Synthetic Module Records"><figure><figcaption>Table 1: Additional Fields of Synthetic Module Records</figcaption>
      <table>
        <thead>
          <tr><th>Field Name
          </th><th>Value Type
          </th><th>Meaning
        </th></tr></thead>
        <tbody>
          <tr>
            <td>[[ExportNames]]
            </td><td><emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of String
            </td><td>A <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of all names that are exported.
          </td></tr>
          <tr>
            <td>[[EvaluationSteps]]
            </td><td>An Abstract Closure
            </td><td>An Abstract Closure that will be performed upon evaluation of the module, taking the <emu-xref href="#sec-synthetic-module-records" id="_ref_5"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> as its sole argument. These will usually set up the exported values, by using <emu-xref aoid="SetSyntheticModuleExport" id="_ref_6"><a href="#sec-setsyntheticmoduleexport">SetSyntheticModuleExport</a></emu-xref>. They must not modify [[ExportNames]]. They may return an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>.
          </td></tr>
        </tbody>
      </table>
    </figure></emu-table>

    <emu-clause id="sec-createsyntheticmodule" aoid="CreateSyntheticModule">
      <h1><span class="secnum">1.2.1</span> CreateSyntheticModule ( <var>exportNames</var>, <var>evaluationSteps</var>, <var>realm</var>, <var>hostDefined</var> )</h1>

      <p>The abstract operation CreateSyntheticModule creates a <emu-xref href="#sec-synthetic-module-records" id="_ref_7"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> based upon the given exported names and evaluation steps. It performs the following steps:</p>

      <emu-alg><ol><li>Return <emu-xref href="#sec-synthetic-module-records" id="_ref_8"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> { [[Realm]]: <var>realm</var>, [[Environment]]: <emu-val>undefined</emu-val>, [[Namespace]]: <emu-val>undefined</emu-val>, [[HostDefined]]: <var>hostDefined</var>, [[ExportNames]]: <var>exportNames</var>, [[EvaluationSteps]]: <var>evaluationSteps</var> }.</li></ol></emu-alg>

      <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">It seems we could set up the environment either here or in Instantiate(). I've chosen to do so in Instantiate() for symmetry with Source Text Module Records, but I don't think there's any actual requirement in that regard.</div></emu-note>
    </emu-clause>

    <emu-clause id="sec-setsyntheticmoduleexport" aoid="SetSyntheticModuleExport">
      <h1><span class="secnum">1.2.2</span> SetSyntheticModuleExport ( <var>module</var>, <var>exportName</var>, <var>exportValue</var> )</h1>

      <p>The abstract operation SetSyntheticModuleExport can be used to set or change the exported value for a pre-established export of a <emu-xref href="#sec-synthetic-module-records" id="_ref_9"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref>. It performs the following steps:</p>

      <emu-alg><ol><li>Let <var>envRec</var> be <var>module</var>.[[Environment]]'s <emu-xref href="#sec-lexical-environments"><a href="https://tc39.es/ecma262/#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>Perform <var>envRec</var>.SetMutableBinding(<var>exportName</var>, <var>exportValue</var>, <emu-val>true</emu-val>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-smr-concrete-methods">
      <h1><span class="secnum">1.2.3</span> Concrete Methods</h1>

      <p>The following are the concrete methods for <emu-xref href="#sec-synthetic-module-records" id="_ref_10"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> that implement the corresponding <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> abstract methods.</p>

      <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">I find having this wrapping sub-clause cleaner and suggest we do the same for Source Text Module Records in the main spec.</div></emu-note>

      <emu-clause id="sec-smr-getexportednames">
        <h1><span class="secnum">1.2.3.1</span> GetExportedNames( <var>exportStarSet</var> )</h1>

        <p>The GetExportedNames concrete method of a <emu-xref href="#sec-synthetic-module-records" id="_ref_11"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> implements the corresponding <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> abstract method.</p>
        <p>It performs the following steps:</p>

        <emu-alg><ol><li>Let <var>module</var> be this <emu-xref href="#sec-synthetic-module-records" id="_ref_12"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref>.</li><li>Return <var>module</var>.[[ExportNames]].</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-smr-resolveexport">
        <h1><span class="secnum">1.2.3.2</span> ResolveExport( <var>exportName</var>, <var>resolveSet</var> )</h1>

        <p>The ResolveExport concrete method of a <emu-xref href="#sec-synthetic-module-records" id="_ref_13"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> implements the corresponding <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> abstract method.</p>
        <p>It performs the following steps:</p>

        <emu-alg><ol><li>Let <var>module</var> be this <emu-xref href="#sec-synthetic-module-records" id="_ref_14"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref>.</li><li>If <var>module</var>.[[ExportNames]] does not contain <var>exportName</var>, return null.</li><li>Return <emu-xref href="#resolvedbinding-record"><a href="https://tc39.es/ecma262/#resolvedbinding-record">ResolvedBinding Record</a></emu-xref> { [[Module]]: <var>module</var>, [[BindingName]]: <var>exportName</var> }.</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-smr-instantiate">
        <h1><span class="secnum">1.2.3.3</span> Instantiate ( )</h1>

        <p>The Instantiate concrete method of a <emu-xref href="#sec-synthetic-module-records" id="_ref_15"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> implements the corresponding <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> abstract method.</p>
        <p>It performs the following steps:</p>

        <emu-alg><ol><li>Let <var>module</var> be this <emu-xref href="#sec-synthetic-module-records" id="_ref_16"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref>.</li><li>Let <var>realm</var> be <var>module</var>.[[Realm]].</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>realm</var> is not <emu-val>undefined</emu-val>.</li><li>Let <var>env</var> be <emu-xref aoid="NewModuleEnvironment" id="_ref_17"><a href="https://tc39.es/ecma262/#sec-newmoduleenvironment">NewModuleEnvironment</a></emu-xref>(<var>realm</var>.[[GlobalEnv]]).</li><li>Set <var>module</var>.[[Environment]] to <var>env</var>.</li><li>Let <var>envRec</var> be <var>env</var>'s <emu-xref href="#sec-lexical-environments"><a href="https://tc39.es/ecma262/#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>For each <var>exportName</var> in <var>module</var>.[[ExportNames]],</li><li>Perform ! <var>envRec</var>.CreateMutableBinding(<var>exportName</var>, <emu-val>false</emu-val>).</li><li>Perform ! <var>envRec</var>.InitializeBinding(<var>exportName</var>, <emu-val>undefined</emu-val>).</li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-smr-Evaluate">
        <h1><span class="secnum">1.2.3.4</span> Evaluate ( )</h1>

        <p>The Evaluate concrete method of a <emu-xref href="#sec-synthetic-module-records" id="_ref_18"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> implements the corresponding <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> abstract method.</p>
        <p>It performs the following steps:</p>

        <emu-alg><ol><li>Let <var>module</var> be this <emu-xref href="#sec-synthetic-module-records" id="_ref_19"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref>.</li><li>Let <var>moduleCxt</var> be a new ECMAScript code <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref>.</li><li>Set the Function of <var>moduleCxt</var> to <emu-val>null</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>module</var>.[[Realm]] is not <emu-val>undefined</emu-val>.</li><li>Set the <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> of <var>moduleCxt</var> to <var>module</var>.[[Realm]].</li><li>Set the ScriptOrModule of <var>moduleCxt</var> to <var>module</var>.</li><li>Set the VariableEnvironment of <var>moduleCxt</var> to <var>module</var>.[[Environment]].</li><li>Set the LexicalEnvironment of <var>moduleCxt</var> to <var>module</var>.[[Environment]].</li><li><emu-xref aoid="Suspend" id="_ref_20"><a href="https://tc39.es/ecma262/#sec-suspend">Suspend</a></emu-xref> the currently <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Push <var>moduleCxt</var> on to the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>; <var>moduleCxt</var> is now the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>result</var> be the result of performing ? <var>module</var>.[[EvaluationSteps]](<var>module</var>).</li><li><emu-xref aoid="Suspend" id="_ref_21"><a href="https://tc39.es/ecma262/#sec-suspend">Suspend</a></emu-xref> <var>moduleCxt</var> and remove it from the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>.</li><li>Resume the context that is now on the top of the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref> as the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Return <emu-xref aoid="Completion" id="_ref_22"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">Completion</a></emu-xref>(<var>result</var>).</li></ol></emu-alg>
      </emu-clause>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-create-default-export-synthetic-module" aoid="CreateDefaultExportSyntheticModule">
    <h1><span class="secnum">1.3</span> CreateDefaultExportSyntheticModule ( <var>defaultExport</var> )</h1>
    <p>The CreateDefaultExportSyntheticModule abstract operation creates a <emu-xref href="#sec-synthetic-module-records" id="_ref_23"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> whose default export is <var>defaultExport</var>. It performs the following steps:</p>
    <emu-alg><ol><li>Return <emu-xref aoid="CreateSyntheticModule" id="_ref_24"><a href="#sec-createsyntheticmodule">CreateSyntheticModule</a></emu-xref>(« <emu-val>"default"</emu-val> », the following steps, the current <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref>, <var>defaultExport</var>) with the following steps given <var>module</var> as an argument:<p></p><ol><li><emu-xref aoid="SetSyntheticModuleExport" id="_ref_25"><a href="#sec-setsyntheticmoduleexport">SetSyntheticModuleExport</a></emu-xref>(<var>module</var>, <emu-val>"default"</emu-val>, <var>module</var>.[[HostDefined]]).</li></ol></li></ol></emu-alg>
    <!-- TODO: Could we apply the new spec closure concept here rather than painstakingly passing _defaultExport_ through [[HostDefined]]? -->
  </emu-clause>

  <emu-clause id="sec-parse-json-module" aoid="ParseJSONModule">
    <h1><span class="secnum">1.4</span> ParseJSONModule ( <var>source</var> )</h1>
    <p>The abstract operation ParseJSONModule takes a single argument <var>source</var> which is a String representing the contents of a module.</p>

    <emu-alg><ol><li>Let <var>json</var> be ?&nbsp;<emu-xref aoid="Call" id="_ref_26"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(%JSON.parse%, <emu-val>undefined</emu-val>, « <var>source</var> »).  <!-- TODO: Refactor JSONParse into an abstract algorithm --></li><li>Return <emu-xref aoid="CreateDefaultExportSyntheticModule" id="_ref_27"><a href="#sec-create-default-export-synthetic-module">CreateDefaultExportSyntheticModule</a></emu-xref>(<var>json</var>).</li></ol></emu-alg>
  </emu-clause>
</emu-clause>
</div></body>